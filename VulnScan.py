#!/usr/bin/python3

import subprocess
import sys
from prettytable import from_csv
import nmap_xml_parser

def vulnscan():
    try:
        host=input("Enter host IP: ")
        port=input("Enter port for scanning: ")
        filename=input("Enter filename for processing output: ")
        xml_file = open (filename, "w+")
        subprocess.call(["nmap", "-sV", "--script=vulscan/vulscan.nse", "--script-args", "vulscandb=scipvuldb.csv", "-p", port, host, "-oX", filename])
        xml_file.close()
        xml_file = open (filename, "r")
        subprocess.call(["python3", "nmap_xml_parser.py",  "-f", filename, "-csv", filename + ".csv"])
        xml_file.close()  
        prettytable_csv_input = filename + ".csv"
        print (prettytable_csv_input)
        fp = open(prettytable_csv_input, "r")
        vuln_table = from_csv (fp)
        fp.close()
        print(vuln_table) 

    except KeyboardInterrupt:
        sys.exit(1)
        
if __name__ == '__main__':        
    vulnscan()
