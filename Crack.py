#!/usr/bin/python3

import subprocess
import sys
import time

def cracking():
    try:
        loop = True
        while loop:
            mode = input("Choose desired action (crack zipfile password/crack linux user passwords/crack MD5 hashes). Use 1/2/3 to make a selection: ") 
            if int(mode) == 1:
                zip_file_path = input("Provide zip file path: ")
                encrypted_hash_output = input("Enter filename/path to save encrypted hash: ")
                with open(encrypted_hash_output, "w+") as f:              
                    subprocess.call(["/usr/sbin/zip2john", zip_file_path], stdout=f)
                print ("Hash saved as", encrypted_hash_output)
                print ("Commencing cracking...")
                time.sleep(3)
                subprocess.call(["john", "--wordlist=rockyou.txt", encrypted_hash_output])
                f.close()
                loop = False 
            elif int(mode) == 2:
                passwd_path = input("Provide passwd file path: ")
                shadow_path = input("Provide shadow file path: ")
                unshadow_output = input("Enter filename/path to save unshadow output: ")
                with open(unshadow_output, "w+") as f: 
                    subprocess.call(["unshadow", passwd_path, shadow_path], stdout=f)
                print ("Unshadowed file saved as", unshadow_output)
                print ("Commencing cracking...")
                time.sleep(3)
                subprocess.call(["john", "--wordlist=rockyou.txt", unshadow_output])
                f.close()
                loop = False
            elif int(mode) == 3:
                hash_file = input("Enter filepath to MD5 hashes to be cracked: ")
                print ("Commencing cracking...")
                time.sleep(3)
                subprocess.call(["john", "--format=raw-md5", "--wordlist=rockyou.txt", hash_file])
                print ("Printing the results...")
                time.sleep(3)
                subprocess.call(["john", "--show", "--format=raw-md5", hash_file])
                loop = False
            else:
                print("Invalid choice, try again")   
                  
    except KeyboardInterrupt:
        sys.exit(1)
        
if __name__ == '__main__':
    cracking()
